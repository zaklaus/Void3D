<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./Sectors_files/filelist.xml">
<link rel=Edit-Time-Data href="./Sectors_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Sectors and portals</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Michal</o:Author>
  <o:LastAuthor>Mike</o:LastAuthor>
  <o:Revision>22</o:Revision>
  <o:TotalTime>95</o:TotalTime>
  <o:Created>2003-05-07T09:36:00Z</o:Created>
  <o:LastSaved>2003-10-27T11:31:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>1521</o:Words>
  <o:Characters>8673</o:Characters>
  <o:Lines>72</o:Lines>
  <o:Paragraphs>17</o:Paragraphs>
  <o:CharactersWithSpaces>10651</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>90</w:Zoom>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:11.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-font-kerning:0pt;}
h2
	{mso-style-next:Normal;
	margin-top:0pt;
	margin-right:-81.0pt;
	margin-bottom:0pt;
	margin-left:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;}
h3
	{mso-style-next:Normal;
	margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;}
h4
	{mso-style-next:Normal;
	margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	font-size:12.0pt;
	font-family:"Times New Roman";}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-next:Normal;
	margin-top:0pt;
	margin-right:0pt;
	margin-bottom:0pt;
	margin-left:-7.2pt;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-style:italic;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin-top:0pt;
	margin-right:-81.0pt;
	margin-bottom:0pt;
	margin-left:0pt;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText2, li.MsoBodyText2, div.MsoBodyText2
	{margin:0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:659236403;
	mso-list-type:hybrid;
	mso-list-template-ids:-834221842 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1
	{mso-list-id:1232153780;
	mso-list-type:hybrid;
	mso-list-template-ids:-841996512 709541130 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l1:level1
	{mso-level-start-at:13;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
ol
	{margin-bottom:0pt;}
ul
	{margin-bottom:0pt;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1074"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
  <o:regrouptable v:ext="edit">
   <o:entry new="1" old="0"/>
  </o:regrouptable>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h1><span style='font-size:24.0pt;mso-bidi-font-size:12.0pt;font-family:"Times New Roman"'>Sectors
and portals<o:p></o:p></span></h1>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>


<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>


<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h1>Introduction to the system<span style='font-size:10.0pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></h1>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Insanity3D uses portal-based HSR (hidden surface removal)
technique for rendering of indoor locations. This technique is taking into account
the fact, that indoor locations usually consist of large areas (rooms or
sectors), which are connected with small connecting holes (portals). And these
portals offer area for optimizations in 3D rendering.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>The basic idea behind this technique is that portals are
much smaller than sectors, and the chance that two portals overlap is relative
small – such a small that we have a good chance not to see adjacent sectors. So
if player is standing in a sector, the engine possibly renders objects in another
one or two sectors, but quickly rejects few dozens of other sectors in the
scene.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><img
width=323 height=243 id="_x0000_i1044" src="Sectors_files\image001.bmp"></p>

<p class=MsoCaption style='margin-left:0pt'><span style='font-size:8.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>Schematic view on scene made of
sectors and portals.<br>
There’s one Primary Sector in each scene,<o:p></o:p></span></p>

<p class=MsoCaption style='margin-left:0pt'><span style='font-size:8.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>Representing the area outside.</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>As the image shows, the scene has multiple sectors,
connected together by some portals. And there’s a portion of scene, which is
not enclosed into a logical sector by walls. In Insanity, this outer space is
also a sector, although it has infinite boundary, and fills entire space not
filled by other sector. We call it <i>Primary sector</i>, and this is also a
root of the scene hierarchy.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Sectors in Insanity engine are objects of type <b>I3D_sector</b>,
which inherit from basic 3D object entity <b>I3D_frame</b>. So sectors are
basically 3D objects with all its characteristics. Anyway, there’re some
limitations. Sectors always have zero position, zero rotation, and scale 1.
They also cannot be linked to other object than sector. This way, sectors are
guaranteed to keep their position and orientation, so that portal positions
never change. It is also useful when objects are linked to sectors – they don’t
need to consider parent’s matrix, because it is always identity matrix.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>The principle of rendering is that if sector is visible
(camera is located in it, or it may be seen inside through a portal), visuals
linked to sector object may be rendered. The visuals must be direct or indirect
children of sector frame. There’s no additional checking if particular visual
is really located inside of the sector’s boundary. If sector is deemed not
visible, all its visual children are not rendered.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>


<h2 style='margin-right:0pt'>

<hr size=1 width="49%" align=left>

</h2>


<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h2 style='margin-right:0pt'><span style='font-size:11.0pt;mso-bidi-font-size:
12.0pt'>Definition of sector and portal<o:p></o:p></span></h2>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>For our purposes, <b>sector </b>is a convex hull enclosing
part of scene’s geometry that is logically belonging to the sector. Practically
this is all the geometry in scene that is located in the sector’s convex hull.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>A question may arise – why convex hull? This is for
convenience –it’s easy to build convex hull from set of points in a space. And
it is quite fast to determine in which sector is given 3D point in the scene
located. These tests are done frequently for proper positioning (linking) of 3D
objects which move.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>A <b>portal </b>is a polygon (made of three or more
vertices), which has all its points laid on a plane, and its shape is convex.
In praxis, this is often rectangle (for doors or windows), but may be other
shape (entry of a cave for example).<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Finally, for proper work of portal rendering, there’s a
connectivity information – telling which sectors are logically connected by
portals. This step is done during preprocessing step after the scene is loaded.
<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><span style="mso-spacerun: yes"> </span><o:p></o:p></span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1046" type="#_x0000_t75" style='width:245.25pt;
 height:185.25pt'>
 <v:imagedata src="./Sectors_files/image001.jpg" o:title="image004"/>
</v:shape><![endif]--><![if !vml]><img width=327 height=247
src="./Sectors_files/image001.jpg" v:shapes="_x0000_i1046"><![endif]><o:p></o:p></span></p>

<p class=MsoBodyText style='margin-right:0pt'><span style='font-size:8.0pt;
mso-bidi-font-size:12.0pt'>Figure 13 – Entry into a cave.<br>
Example of portal (drawn by purple) made of more vertices.</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>


<div class=MsoNormal>

<hr size=1 width="49%" align=left>

</div>


<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h3><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Creating sectors<o:p></o:p></span></h3>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Sectors are created during scene loading. They use
information from geometry of specially marked objects. Each sector may be built
using geometry of one or more visual objects. For proper initialization of
sectors, some rules must are defined:<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>geometry forms closed shape<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>faces of geometry points inside of sector, which means that
sectors are built from inner walls of rooms, not outer<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt'>-<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>there may be holes in the geometry, from which portals are
created<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>The scene loader, which builds sectors, is quite tolerant to
the sector skeleton geometry. There are often degenerate faces (with all 3
points on a line), vertices of adjacent visuals not being aligned exactly on
the same space, and other kinds of problems. These are detected by the builder,
and ignored. Anyway, more critical errors, like flipped faces, duplicated
faces, or invalid shape may result in invalid sector being built.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>The shape of sector doesn’t necessary need to be convex when
modeled, but the system supports only convex sector hulls, so it automatically
computes the hull from all sector’s vertices. The hull is then used for
determination, if object belongs to sector.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>To mark geometry as part of sector skeleton, use {SECT}
keyword in user-defined object properties in your modeling package. The sector
may be formed from one or more such marked visuals. If visual is marked with
the keyword, all its children are examined, and if they are marked too, all the
geometry will become part of the same sector.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>During loading, the sector is created as <b>I3D_sector</b>
interface, inheriting the name of the frame from which it was built with <i>sector</i>
prefix.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>You may also define geometry serving as a helping wall used
only during sector construction, and not put into the scene after loading. Use
{SECT help} keyword.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Read information about object properties to learn<span
style="mso-spacerun: yes">  </span>about additional keywords used during sector
construction.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>


<div class=MsoNormal>

<hr size=1 width="49%" align=left>

</div>


<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h3><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Number of sectors
vs. performance<o:p></o:p></span></h3>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>The number of sectors in scene scales very nice, because it
doesn’t affect rendering speed significantly. Practically, also scenes with
very high number of sectors (hundreds) are not slown down due to sector
preprocessing or other step. This is accomplished by several ways:<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:25.5pt;text-indent:-18.0pt;mso-list:l0 level1 lfo4;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>When determining in which sector a 3D point lies, it is good
to provide a hint to the function, which is pointer to last sector the point
was in. Usually objects stays in the same sector for some time, and change
location only occasionally. This hint helps checking all sectors in scene if
point stays in the same sector.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:25.5pt;text-indent:-18.0pt;mso-list:l0 level1 lfo4;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>When rendering scene, the visibility determination starts
from current camera sector, and expands to neighbor visible sectors, until
there’s no sector seen through portals. With this approach, the number of
sectors in the scene doesn’t have impact on scene preprocessing before
rendering.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Anyway, if you can spare building of another sector, for
example doorpost as separate sector, you may save space by linking the doorpost
to one of adjacent sectors and save redundant sector. You’ll reduce memory
requirements (although by very small amount), but what’s more important, there’ll
be less portals, which need to be checked for intersection.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>


<div class=MsoNormal>

<hr size=1 width="49%" align=left>

</div>


<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h3><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Lighting in
sectors<o:p></o:p></span></h3>

<p class=MsoNormal><b><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></b></p>

<p class=MsoBodyText2>Sectors, beside its main function as rendering
optimization, also serve another task – they’re used as logical locations for sound
and light environments. So it is possible to set different lights and sounds in
particular sector.</p>

<p class=MsoBodyText2>All lighting in a sector is done only from lights, which
are assigned to the sector using <b>I3D_sector::AddLight</b> method. One light
may be assigned to multiple sectors. You may create different atmosphere by
assigning ambient lights in different sectors (e.g. using darker ambient inside
than outside). This is also an optimization, where the number of lights which
may hit geometry in scene is reduced, thus the number of computation is also
reduced.</p>

<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>


<div class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>

<hr size=1 width="49%" align=left>

</span></div>


<p class=MsoBodyText2><b><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></b></p>

<p class=MsoBodyText2><b><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Sounds
in sectors<o:p></o:p></span></b></p>

<p class=MsoBodyText2><span style="mso-spacerun: yes"> </span></p>

<p class=MsoBodyText2>As with lights, sound may be also added to one or more
sector. The difference is that if sound is not added into any sector, it is
audible in all sectors. But as soon as it is added to at leas one sector, it is
audible only when listener is in these particular sectors.</p>

<p class=MsoBodyText2>The sounds are enabled or disabled as listener moves
around sectors. This is accomplished by fading sounds in or out smoothly for
some time in order to avoid sudden starting or stopping sound playback.</p>

<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>


<div class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>

<hr size=1 width="49%" align=left>

</span></div>


<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyText2><b><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Run-time
frame linking to sectors</span></b><span style='font-size:11.0pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyText2>Because sectors are used to optimize rendering, and only
those visuals which are children of visible sector are rendered, it is
necessary to re-link moving objects at runtime to appropriate sectors. This is
done by examining the position of center of such object, and determining the
sector, in which this point is located. Then the moving object needs to be
re-linked to proper sector where it is located in.</p>

<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>


<div class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>

<hr size=1 width="49%" align=left>

</span></div>


<p class=MsoBodyText2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyText2><b><span style='font-size:11.0pt;mso-bidi-font-size:12.0pt'>Problems
when building sectors<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Several problems may arise when building sectors during
loading. Most errors will be reported. Here we’ll discuss most common problems,
and how to avoid them.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h3>Sink portal</h3>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Portal must always be on boundary of sector’s convex hull,
computed from sector’s points. In the image below, the portal #1 is correct,
because it lies on the boundary of the sector’s hull, while the portal #2 is
wrong, because it is sink inside. To correct this problem, you must reorder the
geometry, so that holes are always on sides, which are on the convex hull of
the sector. If you still get this error while having the portal located
correctly, make sure that all coplanar points of the portal are exactly on the
sample plane. Use your 3D modeling package to align the vertices exactly.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<h3>Overlapping sector hulls</h3>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>Because convex hulls of sectors are computed automatically,
it may happen that hulls of sectors, which normally do not collide, overlap, as
shown by colored area in the image below. This makes a problem, because the
determination of current sector from 3D point may either find sector A, or
sector B. In general, this problem is not relevant, it overlapped area is not
accessible and contains no geometry. Anyway, of camera of objects are to be
located in such overlapped area, you should fix this problem.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><!--[if gte vml 1]><v:shapetype id="_x0000_t202"
 coordsize="21600,21600" o:spt="202" path="m0,0l0,21600,21600,21600,21600,0xe">
 <v:stroke joinstyle="miter"/>
 <v:path gradientshapeok="t" o:connecttype="rect"/>
</v:shapetype><v:shape id="_x0000_s1062" type="#_x0000_t202" style='position:absolute;
 margin-left:263.75pt;margin-top:34.5pt;width:10.4pt;height:8.95pt;z-index:6;
 mso-position-horizontal:absolute;mso-position-vertical:absolute' stroked="f">
 <v:textbox inset="0,0,0,0"/>
</v:shape><v:group id="_x0000_s1049" style='position:absolute;margin-left:126pt;
 margin-top:8.75pt;width:126pt;height:90pt;z-index:1' coordorigin="4320,12290"
 coordsize="2520,1800">
 <v:line id="_x0000_s1035" style='position:absolute' from="5580,12650" to="5760,12650"
  o:regroupid="1"/>
 <v:line id="_x0000_s1036" style='position:absolute' from="5580,12830" to="5760,12830"
  o:regroupid="1"/>
 <v:group id="_x0000_s1046" style='position:absolute;left:4320;top:12290;
  width:2520;height:1800' coordorigin="4500,12290" coordsize="2520,1800"
  o:regroupid="1">
  <v:rect id="_x0000_s1034" style='position:absolute;left:4500;top:12300;
   width:1260;height:900;mso-wrap-edited:f;mso-position-vertical-relative:page'
   wrapcoords="-257 0 -257 21600 21857 21600 21857 0 -257 0"/>
  <v:group id="_x0000_s1045" style='position:absolute;left:4500;top:12290;
   width:2520;height:1800' coordorigin="4500,12290" coordsize="2520,1800">
   <v:group id="_x0000_s1044" style='position:absolute;left:4500;top:12290;
    width:2520;height:1800' coordorigin="4500,12290" coordsize="2520,1800">
    <v:group id="_x0000_s1043" style='position:absolute;left:4500;top:12290;
     width:2520;height:1800' coordorigin="4500,12290" coordsize="2520,1800">
     <v:line id="_x0000_s1028" style='position:absolute' from="4500,14090"
      to="7020,14090"/>
     <v:line id="_x0000_s1029" style='position:absolute;flip:y' from="7020,12290"
      to="7020,14090"/>
     <v:line id="_x0000_s1030" style='position:absolute;flip:x' from="5940,12290"
      to="7020,12290"/>
     <v:line id="_x0000_s1031" style='position:absolute' from="5940,12290"
      to="5940,13370"/>
     <v:line id="_x0000_s1032" style='position:absolute;flip:x' from="4500,13370"
      to="5940,13370"/>
     <v:line id="_x0000_s1033" style='position:absolute' from="4500,13370"
      to="4500,14090"/>
    </v:group><v:line id="_x0000_s1039" style='position:absolute;flip:x'
     from="4500,12300" to="5940,13380" strokecolor="blue">
     <v:stroke dashstyle="dash"/>
    </v:line></v:group><v:line id="_x0000_s1041" style='position:absolute'
    from="5760,12290" to="5940,12650" strokecolor="blue">
    <v:stroke dashstyle="dash"/>
   </v:line><v:line id="_x0000_s1042" style='position:absolute;flip:y' from="5760,12830"
    to="5940,13190" strokecolor="blue">
    <v:stroke dashstyle="dash"/>
   </v:line></v:group></v:group></v:group><v:shape id="_x0000_s1052" style='position:absolute;
 margin-left:137.05pt;margin-top:15.7pt;width:51.95pt;height:38.35pt;z-index:2;
 mso-position-vertical:absolute' coordsize="1080,720" path="m0,720l1080,720,1080,,,720xe"
 fillcolor="aqua">
 <v:fill opacity=".5"/>
 <v:path arrowok="t"/>
</v:shape><v:line id="_x0000_s1059" style='position:absolute;z-index:3;
 mso-position-horizontal:absolute;mso-position-vertical:absolute' from="252pt,30.35pt"
 to="261pt,30.35pt"/><v:line id="_x0000_s1060" style='position:absolute;
 z-index:4;mso-position-horizontal:absolute;mso-position-vertical:absolute'
 from="252pt,47.9pt" to="261pt,47.9pt"/><v:line id="_x0000_s1061" style='position:absolute;
 z-index:5;mso-position-vertical:absolute' from="261pt,30.75pt" to="261pt,48.75pt"
 strokecolor="fuchsia"/><v:shape id="_x0000_s1063" type="#_x0000_t202" style='position:absolute;
 margin-left:137.75pt;margin-top:18.15pt;width:16pt;height:11.4pt;z-index:7;
 mso-wrap-edited:f;mso-position-horizontal:absolute;mso-position-vertical:absolute'
 wrapcoords="-655 0 -655 20700 21600 20700 21600 0 -655 0" stroked="f">
 <v:textbox style='mso-next-textbox:#_x0000_s1063' inset="0,0,0,0">
  <![if !mso]>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div>
    <p class=MsoNormal align=right style='text-align:right'><span
    style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial'>B<o:p></o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  <![endif]></v:textbox>
</v:shape><v:line id="_x0000_s1066" style='position:absolute;z-index:8;
 mso-position-horizontal:absolute;mso-position-vertical:absolute' from="252pt,9pt"
 to="261pt,31.5pt" strokecolor="blue">
 <v:stroke dashstyle="dash"/>
</v:line><v:line id="_x0000_s1067" style='position:absolute;flip:x;z-index:9;
 mso-position-horizontal:absolute;mso-position-vertical:absolute' from="251.85pt,47.9pt"
 to="261pt,97.5pt" strokecolor="blue">
 <v:stroke dashstyle="dash"/>
</v:line><v:shape id="_x0000_s1068" type="#_x0000_t202" style='position:absolute;
 margin-left:200.75pt;margin-top:63.95pt;width:9.5pt;height:11.35pt;z-index:10;
 mso-wrap-edited:f;mso-position-horizontal:absolute;mso-position-vertical:absolute'
 wrapcoords="-655 0 -655 20700 21600 20700 21600 0 -655 0" stroked="f">
 <v:textbox style='mso-next-textbox:#_x0000_s1068' inset="0,0,0,0">
  <![if !mso]>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div>
    <p class=MsoNormal align=right style='text-align:right'><span
    style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial'>A<o:p></o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  <![endif]></v:textbox>
</v:shape><v:shape id="_x0000_s1069" type="#_x0000_t202" style='position:absolute;
 margin-left:201pt;margin-top:24.75pt;width:8.95pt;height:11.6pt;z-index:11;
 mso-wrap-edited:f;mso-position-horizontal:absolute;mso-position-vertical:absolute'
 wrapcoords="-655 0 -655 20700 21600 20700 21600 0 -655 0" stroked="f">
 <v:textbox style='mso-next-textbox:#_x0000_s1069' inset="0,0,0,0">
  <![if !mso]>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div>
    <p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
    font-family:Arial'>2<o:p></o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  <![endif]></v:textbox>
</v:shape><![endif]--><![if !vml]><span style='mso-ignore:vglayout'>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=167 height=11></td>
  <td width=183></td>
  <td width=2></td>
  <td width=16></td>
 </tr>
 <tr>
  <td height=35></td>
  <td rowspan=3 align=left valign=top><img width=183 height=123
  src="./Sectors_files/image002.gif" v:shapes="_x0000_s1049 _x0000_s1035 _x0000_s1036 _x0000_s1046 _x0000_s1034 _x0000_s1045 _x0000_s1044 _x0000_s1043 _x0000_s1028 _x0000_s1029 _x0000_s1030 _x0000_s1031 _x0000_s1032 _x0000_s1033 _x0000_s1039 _x0000_s1041 _x0000_s1042 _x0000_s1052 _x0000_s1059 _x0000_s1060 _x0000_s1061 _x0000_s1063 _x0000_s1066 _x0000_s1067 _x0000_s1068 _x0000_s1069"></td>
 </tr>
 <tr>
  <td height=14></td>
  <td></td>
  <td width=16 height=14 align=left valign=top bgcolor=white style='vertical-align:
  top;background:white'><![endif]><![if !mso]><span style='position:absolute;
  z-index:6'>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div v:shape="_x0000_s1062" style='padding:0pt 0pt 0pt 0pt' class=shape>
    <p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
    font-family:Arial'>1<o:p></o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  </span><![endif]><![if !mso & !vml]>&nbsp;<![endif]><![if !vml]></td>
 </tr>
 <tr>
  <td height=74></td>
 </tr>
</table>

</span><![endif]><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<br style='mso-ignore:vglayout' clear=ALL>

<h3>Portals not connected</h3>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'>You may encounter cases where portals of adjacent sectors are
not connected properly. In visualization mode, portals of connected sectors are
drawn in blue, while portals connected to outside (Primary) sector are drawn in
purple. If two portals of adjacent sectors are both drawn in purple, it means
an error and should be fixed, because sector will not work optimally, and may
cause visual artifacts. Common cause of this problem is that portals have
different amount of vertices, or their vertices are not aligned exactly. Use 3D
modeling package to fix this error.<o:p></o:p></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h4><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial'>Unexpected
portals<o:p></o:p></span></h4>

<h4><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h4>

<h4><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Arial;
font-weight:normal'>If you encounter unexpected portals in built sectors,
examine your geometry. Geometry should form closed shape. Most common reason is
that you’ve marked wrong geometry as sector skeleton.<o:p></o:p></span></h4>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>


<div class=MsoNormal>

<hr size=1 width="49%" align=left>

</div>


<p class=MsoNormal><span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

</div>

</body>

</html>
